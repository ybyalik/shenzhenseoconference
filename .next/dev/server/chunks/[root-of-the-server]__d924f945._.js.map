{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/lib/email.ts"],"sourcesContent":["import { Resend } from 'resend';\n\nlet connectionSettings: any;\n\nasync function getCredentials() {\n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY \n    ? 'repl ' + process.env.REPL_IDENTITY \n    : process.env.WEB_REPL_RENEWAL \n    ? 'depl ' + process.env.WEB_REPL_RENEWAL \n    : null;\n\n  console.log('Debug - hostname:', hostname);\n  console.log('Debug - has token:', !!xReplitToken);\n\n  if (!xReplitToken) {\n    console.error('X_REPLIT_TOKEN not found, falling back to env vars');\n    throw new Error('X_REPLIT_TOKEN not found for repl/depl');\n  }\n\n  try {\n    const url = 'https://' + hostname + '/api/v2/connection?include_secrets=true&connector_names=resend';\n    console.log('Fetching connection from:', url);\n    \n    const response = await fetch(url, {\n      headers: {\n        'Accept': 'application/json',\n        'X_REPLIT_TOKEN': xReplitToken\n      }\n    });\n    \n    const data = await response.json();\n    console.log('Connection response:', JSON.stringify(data, null, 2));\n    \n    connectionSettings = data.items?.[0];\n\n    if (!connectionSettings || (!connectionSettings.settings?.api_key)) {\n      console.error('Resend not connected or missing API key');\n      throw new Error('Resend not connected');\n    }\n    \n    return {\n      apiKey: connectionSettings.settings.api_key, \n      fromEmail: connectionSettings.settings.from_email\n    };\n  } catch (error) {\n    console.error('Error fetching connection:', error);\n    throw error;\n  }\n}\n\nasync function getResendClient() {\n  const { apiKey, fromEmail } = await getCredentials();\n  return {\n    client: new Resend(apiKey),\n    fromEmail\n  };\n}\n\nexport async function sendEmail({\n  to,\n  subject,\n  html,\n  text,\n}: {\n  to: string;\n  subject: string;\n  html: string;\n  text?: string;\n}) {\n  try {\n    const { client, fromEmail } = await getResendClient();\n    \n    const { data, error } = await client.emails.send({\n      from: `Shenzhen SEO Conference <${fromEmail}>`,\n      to: [to],\n      subject,\n      html,\n      text: text || html.replace(/<[^>]*>/g, ''),\n    });\n\n    if (error) {\n      console.error('Error sending email:', error);\n      throw error;\n    }\n\n    console.log('Email sent:', data?.id);\n    return { success: true, messageId: data?.id };\n  } catch (error) {\n    console.error('Error sending email:', error);\n    throw error;\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,IAAI;AAEJ,eAAe;IACb,MAAM,WAAW,QAAQ,GAAG,CAAC,0BAA0B;IACvD,MAAM,eAAe,QAAQ,GAAG,CAAC,aAAa,GAC1C,UAAU,QAAQ,GAAG,CAAC,aAAa,GACnC,QAAQ,GAAG,CAAC,gBAAgB,GAC5B,UAAU,QAAQ,GAAG,CAAC,gBAAgB,GACtC;IAEJ,QAAQ,GAAG,CAAC,qBAAqB;IACjC,QAAQ,GAAG,CAAC,sBAAsB,CAAC,CAAC;IAEpC,IAAI,CAAC,cAAc;QACjB,QAAQ,KAAK,CAAC;QACd,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI;QACF,MAAM,MAAM,aAAa,WAAW;QACpC,QAAQ,GAAG,CAAC,6BAA6B;QAEzC,MAAM,WAAW,MAAM,MAAM,KAAK;YAChC,SAAS;gBACP,UAAU;gBACV,kBAAkB;YACpB;QACF;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,QAAQ,GAAG,CAAC,wBAAwB,KAAK,SAAS,CAAC,MAAM,MAAM;QAE/D,qBAAqB,KAAK,KAAK,EAAE,CAAC,EAAE;QAEpC,IAAI,CAAC,sBAAuB,CAAC,mBAAmB,QAAQ,EAAE,SAAU;YAClE,QAAQ,KAAK,CAAC;YACd,MAAM,IAAI,MAAM;QAClB;QAEA,OAAO;YACL,QAAQ,mBAAmB,QAAQ,CAAC,OAAO;YAC3C,WAAW,mBAAmB,QAAQ,CAAC,UAAU;QACnD;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,MAAM;IACR;AACF;AAEA,eAAe;IACb,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM;IACpC,OAAO;QACL,QAAQ,IAAI,oJAAM,CAAC;QACnB;IACF;AACF;AAEO,eAAe,UAAU,EAC9B,EAAE,EACF,OAAO,EACP,IAAI,EACJ,IAAI,EAML;IACC,IAAI;QACF,MAAM,EAAE,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM;QAEpC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,OAAO,MAAM,CAAC,IAAI,CAAC;YAC/C,MAAM,CAAC,yBAAyB,EAAE,UAAU,CAAC,CAAC;YAC9C,IAAI;gBAAC;aAAG;YACR;YACA;YACA,MAAM,QAAQ,KAAK,OAAO,CAAC,YAAY;QACzC;QAEA,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,wBAAwB;YACtC,MAAM;QACR;QAEA,QAAQ,GAAG,CAAC,eAAe,MAAM;QACjC,OAAO;YAAE,SAAS;YAAM,WAAW,MAAM;QAAG;IAC9C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,MAAM;IACR;AACF"}},
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/api/contact/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { z } from 'zod';\nimport { sendEmail } from '@/lib/email';\n\nconst contactFormSchema = z.object({\n  firstName: z.string().min(1, \"First name is required\"),\n  lastName: z.string().min(1, \"Last name is required\"),\n  email: z.string().email(\"Please enter a valid email address\"),\n  requestInvitationLetter: z.boolean(),\n  nationality: z.string().optional(),\n  passportNo: z.string().optional(),\n  passportIssuingOffice: z.string().optional(),\n  dateOfIssue: z.string().optional(),\n  passportExpiration: z.string().optional(),\n  jobTitle: z.string().optional(),\n  durationOfStay: z.string().optional(),\n  additionalMessage: z.string().optional(),\n}).refine((data) => {\n  if (data.requestInvitationLetter) {\n    return (\n      data.nationality &&\n      data.passportNo &&\n      data.passportIssuingOffice &&\n      data.dateOfIssue &&\n      data.passportExpiration &&\n      data.jobTitle &&\n      data.durationOfStay\n    );\n  }\n  return true;\n}, {\n  message: \"All fields are required when requesting a business invitation letter\",\n  path: [\"requestInvitationLetter\"],\n});\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const validatedData = contactFormSchema.parse(body);\n\n    console.log('Contact form received:', validatedData);\n\n    const emailSubject = validatedData.requestInvitationLetter\n      ? 'New Business Invitation Letter Request'\n      : 'New Contact Form Submission';\n\n    let emailHtml = `\n      <h2>${emailSubject}</h2>\n      <p><strong>Name:</strong> ${validatedData.firstName} ${validatedData.lastName}</p>\n      <p><strong>Email:</strong> ${validatedData.email}</p>\n    `;\n\n    if (validatedData.requestInvitationLetter) {\n      emailHtml += `\n        <h3>Passport Information</h3>\n        <p><strong>Nationality:</strong> ${validatedData.nationality}</p>\n        <p><strong>Passport No.:</strong> ${validatedData.passportNo}</p>\n        <p><strong>Issuing Office:</strong> ${validatedData.passportIssuingOffice}</p>\n        <p><strong>Date of Issue:</strong> ${validatedData.dateOfIssue}</p>\n        <p><strong>Expiration Date:</strong> ${validatedData.passportExpiration}</p>\n        <p><strong>Job Title:</strong> ${validatedData.jobTitle}</p>\n        <p><strong>Duration of Stay:</strong> ${validatedData.durationOfStay}</p>\n      `;\n    }\n\n    if (validatedData.additionalMessage) {\n      emailHtml += `\n        <h3>Additional Message</h3>\n        <p>${validatedData.additionalMessage}</p>\n      `;\n    }\n\n    await sendEmail({\n      to: 'jp@shenzhenseoconference.com',\n      subject: emailSubject,\n      html: emailHtml,\n    });\n\n    return NextResponse.json({\n      success: true,\n      message: 'Contact form received successfully',\n      data: validatedData,\n    }, { status: 201 });\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      return NextResponse.json({\n        success: false,\n        message: 'Validation error',\n        errors: error.errors,\n      }, { status: 400 });\n    }\n\n    console.error('Contact form error:', error);\n    return NextResponse.json({\n      success: false,\n      message: 'Internal server error',\n    }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,MAAM,oBAAoB,2IAAC,CAAC,MAAM,CAAC;IACjC,WAAW,2IAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAC7B,UAAU,2IAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;IAC5B,OAAO,2IAAC,CAAC,MAAM,GAAG,KAAK,CAAC;IACxB,yBAAyB,2IAAC,CAAC,OAAO;IAClC,aAAa,2IAAC,CAAC,MAAM,GAAG,QAAQ;IAChC,YAAY,2IAAC,CAAC,MAAM,GAAG,QAAQ;IAC/B,uBAAuB,2IAAC,CAAC,MAAM,GAAG,QAAQ;IAC1C,aAAa,2IAAC,CAAC,MAAM,GAAG,QAAQ;IAChC,oBAAoB,2IAAC,CAAC,MAAM,GAAG,QAAQ;IACvC,UAAU,2IAAC,CAAC,MAAM,GAAG,QAAQ;IAC7B,gBAAgB,2IAAC,CAAC,MAAM,GAAG,QAAQ;IACnC,mBAAmB,2IAAC,CAAC,MAAM,GAAG,QAAQ;AACxC,GAAG,MAAM,CAAC,CAAC;IACT,IAAI,KAAK,uBAAuB,EAAE;QAChC,OACE,KAAK,WAAW,IAChB,KAAK,UAAU,IACf,KAAK,qBAAqB,IAC1B,KAAK,WAAW,IAChB,KAAK,kBAAkB,IACvB,KAAK,QAAQ,IACb,KAAK,cAAc;IAEvB;IACA,OAAO;AACT,GAAG;IACD,SAAS;IACT,MAAM;QAAC;KAA0B;AACnC;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,gBAAgB,kBAAkB,KAAK,CAAC;QAE9C,QAAQ,GAAG,CAAC,0BAA0B;QAEtC,MAAM,eAAe,cAAc,uBAAuB,GACtD,2CACA;QAEJ,IAAI,YAAY,CAAC;UACX,EAAE,aAAa;gCACO,EAAE,cAAc,SAAS,CAAC,CAAC,EAAE,cAAc,QAAQ,CAAC;iCACnD,EAAE,cAAc,KAAK,CAAC;IACnD,CAAC;QAED,IAAI,cAAc,uBAAuB,EAAE;YACzC,aAAa,CAAC;;yCAEqB,EAAE,cAAc,WAAW,CAAC;0CAC3B,EAAE,cAAc,UAAU,CAAC;4CACzB,EAAE,cAAc,qBAAqB,CAAC;2CACvC,EAAE,cAAc,WAAW,CAAC;6CAC1B,EAAE,cAAc,kBAAkB,CAAC;uCACzC,EAAE,cAAc,QAAQ,CAAC;8CAClB,EAAE,cAAc,cAAc,CAAC;MACvE,CAAC;QACH;QAEA,IAAI,cAAc,iBAAiB,EAAE;YACnC,aAAa,CAAC;;WAET,EAAE,cAAc,iBAAiB,CAAC;MACvC,CAAC;QACH;QAEA,MAAM,IAAA,2HAAS,EAAC;YACd,IAAI;YACJ,SAAS;YACT,MAAM;QACR;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;YACT,MAAM;QACR,GAAG;YAAE,QAAQ;QAAI;IACnB,EAAE,OAAO,OAAO;QACd,IAAI,iBAAiB,2IAAC,CAAC,QAAQ,EAAE;YAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,SAAS;gBACT,QAAQ,MAAM,MAAM;YACtB,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;QACX,GAAG;YAAE,QAAQ;QAAI;IACnB;AACF"}}]
}